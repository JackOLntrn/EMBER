<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>EMBER: src/task_read_camera.cpp File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">EMBER<span id="projectnumber">&#160;0.1</span>
   </div>
   <div id="projectbrief">EMBER is a fire suppression system with a thermal IR camera for hot blob detection on a pan/tilt mechanism with a solenoid for commanded water flow.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('task__read__camera_8cpp.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div class="header">
  <div class="headertitle"><div class="title">task_read_camera.cpp File Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Thermal camera reading and hot blob detection task.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;PrintStream.h&quot;</code><br />
<code>#include &quot;<a class="el" href="task__read__camera_8h_source.html">task_read_camera.h</a>&quot;</code><br />
<code>#include &lt;Arduino.h&gt;</code><br />
<code>#include &lt;Wire.h&gt;</code><br />
<code>#include &quot;<a class="el" href="shares_8h_source.html">shares.h</a>&quot;</code><br />
<code>#include &quot;<a class="el" href="task__webserver_8h_source.html">task_webserver.h</a>&quot;</code><br />
<code>#include &quot;adafruit_mlx90640.h&quot;</code><br />
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-define-members" class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:a7aa78d6cedb927c7c091a59f836bd544" id="r_a7aa78d6cedb927c7c091a59f836bd544"><td class="memItemLeft" align="right" valign="top"><a id="a7aa78d6cedb927c7c091a59f836bd544" name="a7aa78d6cedb927c7c091a59f836bd544"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HOTBLOB_DETECT_THRESHOLD</b>&#160;&#160;&#160;50.0f</td></tr>
<tr class="memitem:ad4f3c3cbe9b4b80ae582048cdf972529" id="r_ad4f3c3cbe9b4b80ae582048cdf972529"><td class="memItemLeft" align="right" valign="top"><a id="ad4f3c3cbe9b4b80ae582048cdf972529" name="ad4f3c3cbe9b4b80ae582048cdf972529"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>HOTBLOB_INCLUSION_THRESHOLD</b>&#160;&#160;&#160;49.0f</td></tr>
<tr class="memitem:ac979b3c6b7738736ac98efff27d09b00" id="r_ac979b3c6b7738736ac98efff27d09b00"><td class="memItemLeft" align="right" valign="top"><a id="ac979b3c6b7738736ac98efff27d09b00" name="ac979b3c6b7738736ac98efff27d09b00"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FIRE_ALERT_THRESHOLD</b>&#160;&#160;&#160;70.0f</td></tr>
<tr class="memitem:a957d1481a332c39027cfe9aaa696529b" id="r_a957d1481a332c39027cfe9aaa696529b"><td class="memItemLeft" align="right" valign="top"><a id="a957d1481a332c39027cfe9aaa696529b" name="a957d1481a332c39027cfe9aaa696529b"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>FIRE_COOLDOWN_THRESHOLD</b>&#160;&#160;&#160;60.0f</td></tr>
<tr class="memitem:a893011783fefc21f30baf08142cd3c35" id="r_a893011783fefc21f30baf08142cd3c35"><td class="memItemLeft" align="right" valign="top"><a id="a893011783fefc21f30baf08142cd3c35" name="a893011783fefc21f30baf08142cd3c35"></a>
#define&#160;</td><td class="memItemRight" valign="bottom"><b>NUM_PIXELS</b>&#160;&#160;&#160;768</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-func-members" class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a507280b05384264d1d72fa2b342ad29b" id="r_a507280b05384264d1d72fa2b342ad29b"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#a507280b05384264d1d72fa2b342ad29b">findHotBlob</a> (const float *frame, uint16_t seedIdx, float tempThreshold, uint16_t &amp;outCentroidIdx, float &amp;outMaxTemp, float &amp;outAvgTemp, uint16_t &amp;outSize, float &amp;outCentroidX, float &amp;outCentroidY)</td></tr>
<tr class="memdesc:a507280b05384264d1d72fa2b342ad29b"><td class="mdescLeft">&#160;</td><td class="mdescRight">function which finds the centroid of a hot blob in a thermal frame  <br /></td></tr>
<tr class="memitem:ac5eabc3ec1ec8288c47e240bea71c965" id="r_ac5eabc3ec1ec8288c47e240bea71c965"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="#ac5eabc3ec1ec8288c47e240bea71c965">task_read_camera</a> (void *p_params)</td></tr>
<tr class="memdesc:ac5eabc3ec1ec8288c47e240bea71c965"><td class="mdescLeft">&#160;</td><td class="mdescRight">task which reads the MLX90640 thermal camera and detects hotspots  <br /></td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 id="header-var-members" class="groupheader"><a id="var-members" name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:a8124526300a41e9165373bb939ee0dd6" id="r_a8124526300a41e9165373bb939ee0dd6"><td class="memItemLeft" align="right" valign="top"><a id="a8124526300a41e9165373bb939ee0dd6" name="a8124526300a41e9165373bb939ee0dd6"></a>
Adafruit_MLX90640&#160;</td><td class="memItemRight" valign="bottom"><b>mlx</b></td></tr>
</table>
<a name="details" id="details"></a><h2 id="header-details" class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Thermal camera reading and hot blob detection task. </p>
<dl class="section author"><dt>Author</dt><dd>Jackson Cordova, GPT5-mini </dd></dl>
<dl class="section date"><dt>Date</dt><dd>November 2025 </dd></dl>
</div><a name="doc-func-members" id="doc-func-members"></a><h2 id="header-doc-func-members" class="groupheader">Function Documentation</h2>
<a id="a507280b05384264d1d72fa2b342ad29b" name="a507280b05384264d1d72fa2b342ad29b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a507280b05384264d1d72fa2b342ad29b">&#9670;&#160;</a></span>findHotBlob()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void findHotBlob </td>
          <td>(</td>
          <td class="paramtype">const float *</td>          <td class="paramname"><span class="paramname"><em>frame</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t</td>          <td class="paramname"><span class="paramname"><em>seedIdx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float</td>          <td class="paramname"><span class="paramname"><em>tempThreshold</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t &amp;</td>          <td class="paramname"><span class="paramname"><em>outCentroidIdx</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float &amp;</td>          <td class="paramname"><span class="paramname"><em>outMaxTemp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float &amp;</td>          <td class="paramname"><span class="paramname"><em>outAvgTemp</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t &amp;</td>          <td class="paramname"><span class="paramname"><em>outSize</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float &amp;</td>          <td class="paramname"><span class="paramname"><em>outCentroidX</em></span>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float &amp;</td>          <td class="paramname"><span class="paramname"><em>outCentroidY</em></span>&#160;)</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>function which finds the centroid of a hot blob in a thermal frame </p>
<p>this functions performs a breadth-first search (BFS) starting from a seed pixel to find all connected pixels above a temperature threshold, effectively identifying a "blob" of hot pixels. It computes the weighted centroid of the blob based on pixel temperatures, as well as the maximum temperature, average temperature, and size of the blob.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">frame</td><td>pointer to the thermal frame array (size 768) </td></tr>
    <tr><td class="paramname">seedIdx</td><td>index of the seed pixel to start the search from </td></tr>
    <tr><td class="paramname">tempThreshold</td><td>temperature threshold for including pixels in the blob </td></tr>
    <tr><td class="paramname">outCentroidIdx</td><td>reference to store the index of the computed centroid pixel </td></tr>
    <tr><td class="paramname">outMaxTemp</td><td>reference to store the maximum temperature found in the blob </td></tr>
    <tr><td class="paramname">outAvgTemp</td><td>reference to store the average temperature of the blob </td></tr>
    <tr><td class="paramname">outSize</td><td>reference to store the size (number of pixels) of the blob </td></tr>
    <tr><td class="paramname">outCentroidX</td><td>reference to store the X coordinate of the centroid </td></tr>
    <tr><td class="paramname">outCentroidY</td><td>reference to store the Y coordinate of the centroid </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ac5eabc3ec1ec8288c47e240bea71c965" name="ac5eabc3ec1ec8288c47e240bea71c965"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac5eabc3ec1ec8288c47e240bea71c965">&#9670;&#160;</a></span>task_read_camera()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void task_read_camera </td>
          <td>(</td>
          <td class="paramtype">void *</td>          <td class="paramname"><span class="paramname"><em>p_params</em></span></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>task which reads the MLX90640 thermal camera and detects hotspots </p>
<p>This task continuously reads frames from the MLX90640 thermal camera at a set refresh rate. It processes each frame to find the hottest pixel and then identifies a connected "hot blob" of pixels around it that exceed a defined temperature threshold. The task computes the centroid of the hot blob and applies temporal smoothing to reduce jitter in the detected position. If the maximum temperature of the blob exceeds a fire alert threshold, it sets a shared boolean "fire" to true. The task runs indefinitely with no delay, relying on the camera's refresh rate for timing. <br  />
</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">p_params</td><td>not used and should be set to void in the xTaskCreate call </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<div id="page-nav" class="page-nav-panel">
<div id="page-nav-resize-handle"></div>
<div id="page-nav-tree">
<div id="page-nav-contents">
</div><!-- page-nav-contents -->
</div><!-- page-nav-tree -->
</div><!-- page-nav -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a href="dir_68267d1309a1af8e8297ef4c3efbcdba.html">src</a></li><li class="navelem"><a href="task__read__camera_8cpp.html">task_read_camera.cpp</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
